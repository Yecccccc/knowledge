# MySQL

- 数据库的三大范式

  1. 1NF：每个属性都是原子性的不可再分
  2. 2NF：每个非主键属性都完全依赖于主键，而不是依赖于主键的一部分
  3. 3NF：每个非主键属性不依赖于其他非主键属性

- 关系型数据库和非关系型数据库的优缺点对比，应用场景

  **关系型数据库**

  优点：

  1. 数据结构清晰明了
  2. 数据库查询功能强大，支持复杂语句
  3. 数据库处理能力强，支持ACID原子性、一致性、隔离性、永久性
  4. 数据库具有广泛的英语和成熟的技术支持

  缺点：

  1. 数据库性能受限于数据的规范和复杂的查询语句
  2. 数据库扩展性有限
  3. 数据库规模增大时，数据模型和查询语句变得复杂难以维护
  4. 数据库成本高

  应用场景：数据结构化且事务性处理的应用场景：金融系统、在线交易系统和企业管理系统

  **非关系型数据库**

  优点：

  1. 数据库具有良好的扩展性和高性能，支持水平扩展
  2. 数据库结构灵活，不需要预定义模式
  3. 数据库支持大规模并发用户和高吞吐量访问请求
  4. 数据库成本相对较低，可以运行在廉价设备上

  缺点：

  1. 数据库查询功能相对较弱，不支持复杂查询语句
  2. 数据库事务性处理相对较弱，不支持ACID
  3. 数据库的数据结构相对较复杂，需要更高的积水水平和时间成本进行维护

  应用场景：适用于需要大规模高吞吐、高并发的应用场景，如社交网络、游戏应用、日志处理

- MySQL和PostgreSQL、MongoDB、Redis的区别和应用场景

1. 数据库类型：MySQL PostgreSQL是关系型数据库， MongoDB是面向文档的NoSQL数据库、Redis是内存数据库

2. 存放数据的格式：MySQL PostgreSQL都是基于表格的数据库，MongoDB是面向文档，数据以JSON存储。Redis是键值对存储

3. 持久化方式

   MySQL、PostgreSQL和MongoDB都支持数据持久化，Redis支持内存持久化和磁盘持久化两种方式

4. 是否支持索引和事务

   MySQL和PostgreSQL都支持事务，MongoDB仅在副本集和分片集群中支持部分事务，Redis支持事务但不支持跨多个数据存储区域的事务

- ORM框架，采用ORM框架的优缺点

  ORM是将对象模型映射到关系型数据库模型的技术，将数据库操作转化为对象操作

  优点

  1. 简化开发：自动转换，避免编写冗长SQL
  2. 提高代码复用性
  3. 降低维护成本
  4. 避免SQL注入：ORM将参数传递给数据库时进行了参数绑定，避免SQL注入

  缺点：

  1. 性能问题：ORM框架不如手写的SQL性能高
  2. 学习成本高
  3. 灵活性受限：无法处理复杂查询
  4. 难以调试：自动处理，遇到错误可能调试困难

- 如何对数据库进行优化

  1. 字段：设计合理的表结构和字段类型，表结构设计应该符合数据库范式。字段类型应该选择合适数据类型，避免过大过小
  2. 事务：保证数据完整性和一致性的重要手段，应尽量将多个操作封装到一个事务中，减少事务提交次数
  3. 索引：创建索引时，应根据实际查询场景选择合适索引，避免创建过多索引
  4. 避免全表查询：使用条件查询或者限制查询范围
  5. 优化查询语句：应该尽量避免复杂的查询语句和嵌套子查询语句
  6. 调整数据库参数：根据实际场景和欢家合理调整数据库参数，如缓冲区大小、连接数等

- JOIN和UNION的区别

  1. JOIN

     用于将多个表的数据关联起来，返回结果是一个包含多个表的交叉结果集

  2. UNIOPN

     用于合并多个SELECT语句的结果集，返回的结果集包含所有SELECT语句的结果集的并集

- 如何进行多表查询

  多表查询可以通过JOIN实现

  1. INNER JOIN：返回两个表中符合JOIN条件的记录集
  2. LEFT JOIN：返回左边表中所有记录和右边表中符合JOIN条件的记录集，如果右边没有匹配的，返回NULL
  3. RIGHT JOIN：返回右边表中所有记录和左边表中符合JOIN条件的记录及，无匹配返回NULL
  4. FULL OUTER JOIN：FULL OUTER JOIN用于返回两个表中所有记录，如果一个表中没有匹配的记录，则返回NULL值

- 为什么要分库分表，如何进行分库分表

  随着业务的增长和数据量的快速增加，单一数据库很难承载这些数据，所以采取分库分表。可以将数据分散到多个数据库和表中，提高数据的存储和查询效率，降低数据库的负载

  优点：

  1. 提高数据库性能
  2. 增强数据库可用性
  3. 降低数据库成本

  实现方法：

  1. 水平分表：按照行来进行分表
  2. 垂直分表：按照列来进行分表
  3. 分库：拆分到多个数据库里

- left union、inner union的区别

  这是seletc语句进行UNION操作用到的方式

  1. LEFT UNION：会包括左侧select语句中的所有行，同时只包括右侧select语句中与左侧匹配的行，未匹配则NULL
  2. INNER UNION：仅仅包含左右select语句中匹配的行

- 主从复制的原理

1. 为何需要主从复制

   实现读写分离、数据的备份和恢复、数据分析

2. 原理是什么

   主从服务器建立连接，主服务器记录二进制日志，将二进制日志传递到从服务器

   从服务器将收到的二进制日志保存在中继日志中，重放中继日之来同步主库数据到从库

   从库可以配置为只读，可以进行读操作，也可以进行一些轻负载的写操作

3. 如何去实现主从复制

   配置主服务器，开启二进制日志

   配置从服务器，指定主服务器地址，配置主从复制到用户

   在主服务器上创建主从复制用户，并授权给从服务器

   在从服务器上启动主从复制进程

- 一条SQL语句的执行过程，SELECT是如何执行的，UPDATE是如何执行的

连接器：接收客户端的连接请求，建立连接，验证客户端身份，连接建立后，客户端发送SQL语句给服务器

缓存：在连接器中，MySQL有一个缓存区，用于存放最近执行过的SQL语句，如果这个SQL语句已经在缓存中，直接返回结果。不会再次执行，也叫查询缓存

分析器：对SQL语句进行语法解析和词法分析，确定语法是否正确，识别关键字、表名、列名等

优化器：对SQL语句进行优化，生成一个最优的查询执行计划

执行器：按照优化器生成的查询执行计划，执行SQL语句

- 什么是索引，为什么要用索引，索引的优缺点

  索引是一种数据结构，加速数据库表的数据检索

  优点：

  1. 提高查询性能
  2. 优化排序
  3. 加快数据修改和删除
  4. 唯一性约束

  缺点：

  1. 占用存储空间
  2. 降低写性能
  3. 不适合少量数据
  4. 索引过多会影响性能

- 索引的实现方式/索引采用的数据结构，它们之间的区别

1. B树：一种平衡树，将每个节点上的键值分布在一个范围内。

2. B+：所有数据都存储在叶子节点上，中间节点只存储键值信息，可以减少I/O操作，提高查询性能

3. 哈希：映射到哈希表中，计算哈希值即可定位数据块

4. 全文索引：使用全文搜索算法，可以在文本数据中快速查找关键词。全文索引通常用于搜索引擎等需要大量文本数据进行搜索的场景

5. B+树和B树的区别

   B树每个节点既可以是中间节点，也可以是叶子节点，中间节点和叶子节点的结构相同。中间节点存储信息和指向子节点的指针，叶子节点存储键值信息和指向数据的指针

   B+树所有数据都存储在叶子节点上，中间节点只存储键值信息和指向子节点的指针。叶子节点按照键值的大小顺序链接在一起，形成一个有序链表。

   频繁查询/排序：B树

   搞笑等值查询：B+树

6. B+树和Hash的区别：

   B+树保证了数据的有序性，但是B+树不如HASH高效，HASH适用于等值查询

7. B+树索引的优缺点：

   优点：保证有序性、支持范围查询、排序。利用操作系统缓存机制可以减少IO操作次数。支持高并发访问，适合多用户、多线程。对于大量数据，B+树可以分块存储，减少内存占用。

   缺点：创建维护索引需要大量时间、空间。B+树高度增加时，查询效率会降低。B+适合单表查询，不适合关联查询。对于输入插入和删除操作比较频繁的表，B+树索引需要频繁重构，性能会受损。

- 主键索引，组合索引，唯一索引，聚簇索引，非聚簇索引

  主键索引：用于表示表中的唯一记录。强制要求表中每一行记录都有一个唯一的标识（唯一记录）

  组合索引：是由多个列组成的索引，可以提高多列查询效率，避免多次索引扫描操作（多表查询、排序）

  唯一索引：要求每个索引列的值都是唯一的，保证数据的唯一性，且可以为NULL（不允许重复）

  聚簇索引：数据存储在索引的叶子节点上，索引和数据存储在一起，适用于范围查询

  非聚簇索引：一般的索引类型，将索引和数据分开存储，适用于不需要频繁更新的列

  主键不能为空，unique可以为空，数据表只能有一个主键索引，可以有多个唯一索引。

  主键索引可以被其他表外键引用，唯一索引不行

- 什么是回表查询，非聚簇索引一定要回表查询吗

在非聚簇索引中，存储的只是索引列的值以及指向数据行的指针，并不包含其他列的值。如果在查询中需要获取其他列的值，就需要通过指针回到原始数据表中查找，这个过程被称为回表查询。

非聚簇索引并不一定要回表查询，如果查询语句只需要索引列的值，就可以通过索引的叶子节点直接获取数据，不需要回表查询

- 索引什么时候会失效

1. 使用了函数或者表达式（进行全表扫描）
2. 对索引列进行了类型转换（全表扫描）
3. 对索引列进行了运算
4. LIKE模糊匹配
5. NULL值判断
6. 存在NULL值
7. 索引数据分布不均匀

- 最左前缀匹配规则

最左前缀匹配规则是指，在一个联合索引中，如果查询语句只涉及到联合索引的最左边的若干个列，那么这个联合索引就可以被用到，而且可以被充分利用

- MySQL中SQL语句执行太慢，是什么原因，怎么解决，用什么命令查看

原因：表结构不合理、索引确实、SQL语句不规范

命令查看：

1. EXPLAIN：用于分析SELECT语句的执行计划，可以查看MySQL的优化器如何处理SQL语句。
2. SHOW PROCESSLIST：用于查看MySQL当前正在执行的所有进程，包括哪些SQL语句正在执行、执行的时间、状态等信息。
3. SHOW STATUS：用于查看MySQL的性能指标，包括数据库连接数、查询缓存命中率、InnoDB缓存命中率等等。
4. PERFORMANCE_SCHEMA：用于收集MySQL的性能数据，包括SQL语句的执行时间、I/O操作的时间、锁等待时间等等。

- MySQL数据库有哪些锁

1. 1. 共享锁：允许多个事务同时持有一把锁，且都只能读，不能修改
2. 排他锁：只允许一个事务持有该锁，持有该锁的事务既能读也能修改数据
3. 更新锁：共享锁+排他锁
4. 行锁：单个数据行上的锁，即只对一行进行加锁。
5. 表锁：表锁是对整张表加锁，即对整张表进行加锁

- 什么是死锁，如何解决死锁，如何避免死锁？

1. 死锁：两个或多个事务在等待对方释放资源时都无法继续执行的状态
2. 解决死锁：回滚事务、杀死事务、等待超时
3. 避免死锁：减少事务锁的时间、按照顺序访问资源、使用合理索引、分解大事务

- 什么是脏读、不可重复读、幻读


1. 脏读：一个事务读取了另一个事务未提交的数据，如果另一个事务回滚，读取无效的情况
2. 不可重复读：一个事务中，多次读取同一条数据，每次读取得到的结果不同。
3. 幻读：一个事务在读取某个范围内的数据时，另一个事务在该范围内插入了新的数据。

- 事务的隔离级别

1. 读未提交：允许一个事务读取另一个事务尚未提交的数据，也就是脏读
2. 读已提交：一个事务只能读取另一个事务已经提交的数据，避免了脏读，但可能出现不可重复读和幻读
3. 可重复读：在一个事务中多次读取同一数据，能够得到一致的结果。在该隔离级别下，不会出现脏读和不可重复读，但是可能出现幻读
4. 序列化：最高的隔离级别，强制事务串行执行，避免了脏读、不可重复读和幻读，但是性能相对较差。

- 事务的四大特性（ACID），MySQL是如何实现ACID的

1. A原子性：在事务执行过程中，所有的操作要么全部提交，要么全部回滚。
2. C一致性：事务执行前后，数据库的数据都必须满足预定义的约束条件，例如唯一性约束、外键约束等
3. I隔离性：多个事务并发执行时，每个事务都应该感受不到其他事务的存在，即每个事务都应该像是独立执行的
4. D持久性：事务提交后，数据必须被持久化到磁盘上，即使发生了宕机等故障，也不能造成数据的丢失
5. 实现方式：崩溃恢复、事务日志、锁机制、MVCC

- MySQL的存储引擎

1. InnoDB：InnoDB是MySQL默认的存储引擎，支持事务、行级锁、外键约束等功能，适用于处理大量并发操作和事务处理。
2. MyISAM：MyISAM不支持事务，但它的读写性能较高，适用于读密集型应用。
3. Memory：Memory存储引擎将数据存储在内存中，读写速度非常快，但是数据容易丢失，适用于缓存和临时表等场景。
4. Archive：Archive存储引擎适用于存储和检索大量历史数据的场景，它可以高效地压缩数据，但是不支持更新操作。
5. NDB Cluster：NDB Cluster存储引擎是MySQL集群的核心存储引擎，支持高可用和高可扩展性，适用于大规模高并发的应用。

- MVCC

  用于实现数据库并发控制的技术。InnoDB用MVCC实现事务的隔离性

  MVCC通过时间戳来控制事务的并发访问。在InnoDB中，每个事务在开始时都会被分配一个唯一的版本号，该版本号会被用于区分该事务所读取到的数据版本。



